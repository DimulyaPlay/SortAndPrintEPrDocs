Утилита для сортировки документов с сайта в соответствии с квитанцией по отправке.
В версии TRON и JAVA доступна печать сообщений из Outlook(нужно установить OutlookFileDragSetup)
Текстовый файл с ключем не обязателен, но в него можно положить свой ключ, чтоб убрать вотермарки


Краткие особенности версий:
-Legacy - печать через утилиту - печатает все документы корректно, нет печати из почты, не быстрый вывод на печать

-Tron - печать через встренную библиотеку - очень быстрый вывод на печать, но в режиме 2стр на 1л и 
конвертированных картинках есть водяные знаки, в редких нет изображений на листе

-Java - печать через виртуальную машинуу java - печатает все документы корректно, скорость вывода 
зависит от содержания (от очень быстро до очень долго). Виртуальная машина может поглощать много 
оперативной памяти, объем можно задать в панели управления java


-При запуске в левом верхнем углу экрана появляется полупрозрачный интерфейс,
за верхнюю левую часть его можно перетащить в любое место экрана,
Дропзона для перетаскивания архивов находится в нижней части, обозначена большим плюсом и ограничена рамкой.
S для открытия настроек
Х для закрытия программы
_____________________________________________________________

-Параметры (S)
Удалить Zip:
Удаление архива после распаковки

Эко режим:
Присоединение протоколов проверки к документу для дуплексной печати

Прямая печать:
Если включена опция прямой печати на принтер, то при перетаскивании в дропзону архива с сайта ЭПр (или сообщений из outlook для TRON и JAVA версии)
 появится окно, в котором отображаются все документы, количество страниц и листов, которые будут затрачены на печать. 
Если выключена, то просто откроется папка с отсортированными документами
При нажатии кнопки печать выбранные документы с заданным параметром печати будут по очереди отправлены в очередь печати (Legacy - череза программу pdftoprinter, Tron - через свою библиотеку, Java - через виртуальную машину java).

По окончании процесса постановки в очередь печати появится уведомление(в TRON и JAVA версии просто все документы подсветсятся зеленым, а кнопка "печать" вернется в ненажатое состояние), после этого можно закрыть все окна, документы будут напечатаны.
Если папка не открылась, или не пошла печать, то что-то пошло не так. Желательно написать на почту krasnokamsky.perm@sudrf.ru с прикреплением 
архива или .msg, в котором случилась ошибка для исправления багов.

Сохранять статистику:
Сохранение статистики печати документов в файл statistics.xlsx в директории программы. Сохраняет только с ЭПР.

Прозрачность интерфейса:
На деле это непрозрачность, но я уже скомпилировал так. Непрозрачность главного окна в процентах.

Название принтера для печати:
Печатает на выбранном принтере

Автор:
Я

GitHub:
Репозиторий проекта на гитхабе

Открыть статистику:
Открыть файл с записанной статистикой

Открыть конфиг:
Открыть файл конфигурации
______________________________________________________________

-Меню печати

Левый столбец чекбоксов - выбор документов для печати. В заголовке окна всегда сумма выбранных док-ов
Самый верхний чекбокс позволяет за раз выставить или снять чекбоксы со всех документов
Столбец "название документа" - название документов
Столбец "страниц" - количество страниц в документе
Столбцы 1-4 - выбор ражима печати N-страниц на листе
Двойной клик по документу откроет его (если это тема сообщения, то откроется письмо в outlook)
Кнопка "открыть папку" открывает папку с отсортированными документами
Кнопка "Печать" передает все документы в очередь печати,  в java и tron по мере отправки названия подсвечиваются зеленым, на период постановки в очередь 
кнопка "проваливается" чтобы избежать повторной печати
"Всего страниц для печати" отражает сумму страниц документов выбранных для печати
"Листов" отражает сумму листов, которые будут затрачены для печати выбранных документов в выбранных режимах
Чекбокс "добавить в статистику" появляется при выбранной опции сохранения статистики. Включен по-умолчанию.(Для того, чтобы не 
сохранять повторно, если по какой-то причине добавленные в очередь документы не были напечатаны.)
Правый столбец чекбоксов(только для Tron) - принудительная конвертация, если изображения не пропечатались или вообще пустые листы
______________________________________________________________


-Системные требования: 

Windows 7 и новее 
для win 7 обновление KB3063858 (в папке Stuff)
для прямой печати до версии 2_4_5: утилита PDFtoPrinter (в папке Stuff)
для обработки сообщений Outlook: расширение OutlookFileDrag (в папке Stuff)(только для TRON и Java версии)
для Java версии установка джавы. (в папке Stuff)
______________________________________________________________


-Планы развития:
интеграция на сайт в качестве браузерного расширения (Не имеет смысла)[-]
пакетная печать файлов msg c выбором вложений.[+]
режим быстрой печати (дропзона для моментального вывода всех документов)(Не имеет смысла)[-]


групповая печать - "склеивание" документов друг с другом (например, если прислали много страниц в виде фото) -- на java реализация возможна, но не ясно как это реализовать в UI
изменение порядка печати сообщений(вложений) перетаскиванием -- проблема с реализацией на tkinter
режим ручной печати (дропзона для дропа любых выделенных файлов со своим меню печати) -- проблема с парсингом путей
______________________________________________________________


-Изменения

1_0_7_Java от 23.09.2022

Добавлены правила для полей ввода копий. Если в поле не будет числа или будет текст, количество приравнивается к 1
Добавлены исключения для конвертации файлов офиса: если не сможет удалить исходник, просто оставит его в покое. 
Если не сможет подключиться к офису и сконвертировать его, то не станет печатать и покрасит красным цветом.


1_0_7_Java от 22.09.2022

-Добавлена функция групповой печати(только для .MSG). Пока может быть только одна группа, если надо будет, сделаю больше.
При нажатии ПКМ по файлам, они добавится в группу. Когда пойдет процесс постановки в очередь печати, выбранные файлы будут игнорироваться,
а когда дойдет очередь до самого нижнего файла в группе, все файлы будут объеденены в один pdf файл и распечатаны в том порядке, в котором они были добавлены в группу.
Параметры печати(копий, n-страниц на листе) применяются от самого нижнего выбранного файла в очереди(самый нижний из выбранных).


1_0_6_Java от 20.09.2022

Статистика и конфиг файл теперь сохраняются в папку документы пользователя.
В параметрах теперь отображаются все установленные принтеры, включая сетевые.
Печать ЭПр: добавлено поле "Копий:", которое отвечает за количество циклов печати всех выделенных документов, также дублирует в статистику как несколько копий печати.
Исправлено сохранение некоторых столбцов статистики, которые, как оказалось, не писались с незапамятных времен.
Исправлено открытие архивов с (1) (2) и т.д. на конце
Исправил игнорирование заданного числа копий для вложений .msg вайлов.


1_0_6_Java от 19.09.2022

Добавлена проверка соответствия номера квитанции номеру архива(встретились в архиве две квитанции одновременно)
Добавлены поля ввода для печати нескольких копий
Добавлена проверка на запароленный архив. Зависать программа больше не будет, а в списке будут непечатаемые файлы с расширением .lockedArchive, может позже сделаю поле ввода
Больше не нужен 7z или unrar в системе


1_0_5_Java от 15.09.2022

Добавлена опция "без протоколов". Игнорирует протоколы проверки файлов при обработке и печати.
Добавлено исключение, которое позволит работать без outlook


1_0_4_Java от 09.09.2022

пофикшены проблемы с разделением по 10 страниц в документах, которе больше делить не надо (при включении режима печати 2 на 1, 4 на 1)
редкие документы больше не показывают 0 страниц.

Обнаруженные проблемы:
попался первый документ, который java не может распечатать из-за кривых метаданных в нем. 


1_0_3_Java от 05.09.2022

Удален правый столбец чекбоксов
Добавлено фантомное разделение по 10 страниц для избежания ограничений бесплатной библиотеки.


1_0_2_Java от 31.08.2022

-Отказался от фреймворка PDFTron в пользу написания своего модуля печати на java.
-Вместе с программой запускается jar файл в виртуальной машине java(Прибавилась к системным требованиям(обязательно наличие в PATH системы)).
-В него на данный момент перенесены функции: печати на принтер, объединения пдф файлов, 
конвертация из изображений в пдф, извлечение текста из квитанции. 
-Вотермарок больше нет. 
-Печать несколько замедлилась из-за рендера документов, но вроде как, решена проблема с пропажей части контента или всего контента при печати. 
-Чекбоксы справа для принудительной конвертации, которые были костылем на такой случай теперь не нужны, но я вспомнил об этом только сейчас.
- Может внезапно жрать много оперативки, это можно настроить в параметрах джавы в панели управления (изучаю джаву всего неделю, не шарю, как правильно отбирать у нее память обратно)


1_0_10_TRON от 18.08.2022 Финальная в этой ветке развития

Добавлены и протестированы форматы для конвертации через АПИ офиса: odt, ods, xls, xlsx (не будут иметь водяных знаков при печати)

Пока не обрабатываются вложения в виде сообщений оутлук.


1_0_9_TRON от 14.08.2022

-Теперь программу компилирую не в единичный файл, поэтому запуск намного быстрее.
-Файл установки распаковывает программу в указанную директорию и создает ярлык на рабочем столе.
-Исправлены ошибки распаковки при наличии множества вложенных папок
-Конвертация из редактируемых файлов (doc и пр.) теперь как раньше через API ворда чтоб не было водяных знаков
-Исправлены ошибки, когда не пересчитывалось количество страниц при выборе режима печати в меню печати почты
-Добавлена поддержка .rtf файлов, убрана поддержка .heic файлов
-Исправлена ошибка кнопки принудительной конвертации
-Добавлена колонка в статистике: время загрузки документа в очередь печати(для исследований)
-Исправлены имена файлов, которые сохраняются в истории spooler (все сохранялось с temp именем)


от 2_4_5 до 1_0_8_TRON от 08.08.2022

-Миграция на фреймворк PDFTron, работа скриптов печати, сортировки и расчета статистики ускорена в разы
Минус подхода: фреймворк с безлимитным триальным ключем, при печати файлов, которые конвертируются в ПДФ, 
на листе присутствует полупрозрачная вотермарка PDFTRON, также лезет в сеть, чтоб передавать статистику
но благо великий судебный фаервол не дает это делать.

-Добавлено появление окна печати для .msg файлов:
Список формируется по порядку тема(синий шрифт) - вложения(со смещением)
Все вложенные архивы распаковываются и файлы из них также включаются в список
Все файлы вложений для печати конвертируются в ПДФ и будут иметь вотермарку
Файлы, которые не могут быть сконвертированы в ПДФ, тоже появятся в списке, но будут доступны только для открытия двойным кликом
Расчет страниц и листов также производится
Выбор режима печати нескольких страниц на одном листе также работает
Двойной клик по вложениям открывает файл в приложении по умолчанию
Двойной клик по теме сообщения открывает сообщение в Outlook
Ширина окна регулируется в зависимости от длины текста тем

-Общие изменения для обоих меню печати:
Убраны кнопки предпросмотра
Убраны уведомления о постановке в очередь
После нажатия кнопки "печать" она остается в нажатом состоянии(неактивна, чтобы избежать лишних кликов) до тех пор, пока все
документы не будут отправлены в очередь, загрузка в очередь отображается в реальном времени: успешно загруженные подсвечиваются зеленым
и с них снимается чекбокс.
Добавлен чекбокс, который выставляет или снимает сразу все чекбоксы для печати.
Добавлены доп чекбоксы справа, на случай, если принтер выдает чистые листы на каком-то документе(почти всегда это доверенности). Он запускает принудительную конвертацию, и тогда распечатется нормально.


2_4_5 уже не вспомню что изменял, но фиксы были важные. Финальная в этой ветке развития


2_4_4 от 22_07_2022

-Изменен интерфейс:
При попадании указателя мыши с зажатым файлом окно становится непрозрачным и "+" загорается зеленым цветом, после обработки возвращается в исходное положение

-Начат процесс пакетной обработки .msg (расширение OutlookFileDrag)


2_4_3 от 22_07_2022 тестируется

-Изменен интерфейс:
Добавлены кнопки для открытия статистики и конфига в меню настроек

-Переработана система сохранение конфигурации(выведена в модуль)
-Переработана система ведения статистики(выведена в модуль)


2_4_0 от 21_07_2022

-Изменен интерфейс:
добавлена кнопка настроек (S)
уменьшен размер верхней панели и кнопок
добавлено визуальное обозначение дропзоны в виде "+"
добавлена изменяемая прозрачность окна. меняется ползунком в настройках(10-100%)

-Добавлены комментарии ко всем функциям в коде


2_3_3_stable 20-07-2022

-Теперь статистика учитвает протоколы, которых уходят на обратную сторону бумаги, тем самым экономя лист.


2_3_3_stable

-В настройках добавлена опция сохранение статистики.(необходимо перед запуском удалить старый конфиг файл)
Сохраняет статистику в директорию программы в файл statistics.xlsx
В настойках печати при включенном ведении статистики отображается чекбокс добавления статистики текущего документа (на всякий случай)
-добавлены некоторые исключения для конвертации файлов при дублировании имен (img2pdf, word2pdf)
-в названии окна печати теперь отображается количество документов, отмеченных для печати
-при печати теперь квитанция минует обработку и передается в печать как оригинальный файл, чтобы можно было отслеживать печать документов
по логам системы(по номеру обращения).
-пофикшены некоторые редкие ошибки обработки имен
Работу над ведением статистики пока закончиваю в таком виде, начинаю работу над обработкой печати .msg файлов.



2_3_1_6

- Скрыто окно cmd, мелькающее при отправке на печать
- Добавлена дата компиляции версии в меню автора


2_3_1_5

-Добавлена обработка изображений (присылают через обращения)
-Оптимизирован алгоритм первоначальной обработки (все манипуляции с файлами происходят только 
при печати или предпросмотре, до этого файлы не обратываются)
-Артефакты при печати устраняются изменением параметров принтера (на 2035 у меня это была настройка "масштабирование шаблона" в пункте 
графика раздела изображения. Поменял с авто на средне и артефактов не стало)

С защищенными атрибутами(запрет поворота листов и т.д.) можно побороться, только перейдя на другой модуль обработки pdf, который не имеет документации, так что хз когда руки дойдут


2_3_1

-Меню настроек
добавлен пункт выбора принтера по умолчанию для приложения
добавлена кнопка, отсылающая на GitHub проекта

-Меню печати
доделан автоповорот/вписывание в формат а4(за исключением защищенных pdf)
добавлены переключатели режимов печати 1 на 1, 2 на 1 и 4 на 1 листе соответственно
добавлена кнопка просмотра документа в выбранном режиме
двойной клик по документу открывает его
добавлена кнопка открытия папки с документами
добавлен счетчик затрачиваемых листов при печати(учитывает все выбранные режимы всех документов)
размер окна по в ширину зафиксирован, в высоту растет до 20 документов, 
затем появляется скроллбар (вручную размер изменять нельзя)

-Остались проблемы
редкие артефакты при печати сдвоенных/счетверенных страниц через pdftoprinter (если этот же документ 
печатать в режиме просмотра из адоб, то все в порядке)
-защищенные атрибуты некоторых pdf-файлов не дают их вращать, они сохраняют свою иначальную форму, 
просто уменьшаются в два раза и вписываются в портретную страницу.

P.S.
Приходится так извращаться с pdf потому что очень сложно подружить печать пдф и принтер. Все печатается 
размер в размер и в портретном режиме, даже не учитывая слепую зону принтера. Если есть варианты как 
можно просто взять и вывести на печать документ(быстро, а не как адоб), чтоб он был подоган в размер бумаги принтера, жду письмав.


2_1_6

Введен жесткий мониторинг очереди печати принтера и отрегулировано ее наполнение документами, 
чтобы все наконец печаталось в правильном порядке
Введен автоповорот листов в портретную разверстку
введено вписывание непропорциональных формату А4 страниц в страницу А4.(Fit page to a4) Экспериментальная, скомпилена в отдельный EXE

Проблемы:
-Пока не выходит побороть обрезание некоторых непропорциональных документов по краям (заметно на чеках сбербанка) и печать в центре страницы



2_1_3

!удалить старыфй конфиг перед использованием, удалить GSPRINT и GHOSTSCRIPT, разместить PDFtoPrinter.exe в директории сортировщика
 
-Завершено окно печати. 
Кнопка печать отправляет по очереди все выбранные документы в очередь принтера(нужно еще дорабатывать мониторинг очереди принтера). 
В последней строке отображается суммарное количество страниц выбранных документов. 
GSPRINT работал медленно и не учитывал размер листов в принтере, поэтому теперь используется другая консольная утилита PDFtoPRINT.
Открыть интересующий документ можно двойным кликом по названию.


2_1_2
-Наспех добавлено окно печати с выбором файлов и отображением количества страниц(тестирутеся, будет переработано)


2_1_1
-Добавлена функция прямой печати на принтер. Вместо открытия папки, отправляет все документы в очередь печати принтера по умолчанию с периодичностью в 1 секунду. Для работы прилагаемые GSPRINT и GHOSTSCRIPT папки необходимо разместить вместе с EXEшником, также необходимо удалить конфиг, чтобы сформировался новый. По умолчанию опиция выключена. Версия промежуточная, для проверки работоспособности, так как не юзабельна без понимания сколько старниц в каком документе, по крайней мере, для исков.
-Исправлен баг с невозможностью работы, если архив уже был распакован ранее и в папке мешанина из старых и новых файлов. просто создается новая папка, если оригинал уже есть.

2_0_2
-исправлен баг с остановкой работы если есть документы без протокола проверки.
-исправлен баг с остановкой работы при обработке отчетов с почты россии (они формируют битые файлы). Протокол к таким файлам не присоединяется и просто нумеруется как раньше.
-остался баг с тем, что нельзя распаковать два раза один архив, решу методом распаковки в другую папку, если такая существует

2_0
-При первом запуске в директории появляется конфиг. хранит параметры, которые выбираются в меню настроек программы которое открывается по 
двойному клику на верхней рамке окна.
-На данный момент в меню две опции: удаление исходного архива и ЭКО мод. Первое итак ясно. А ЭКО мод объеденяет доумент и протокол в 
один файл, что позволяет сэкономить до 50% бумаги. В случае, если будет документ Word,  он сконвертируется в PDF через API Word и к нему также прилепится протокол
-Отказался от затеи с чтением протоколов, оптимизировал распознавание по именам, больше 20 исков проверил, ни одной ошибки не было, кроме левых протоколов, которые просто копия оригинального протокола.


1_5
-Теперь протокол и файл признаются совпавшими не по первому попавшемуся вхождению строки в строку, а по рейтингу str match>0.95.

-------------------------------------------------
1_4
-Добавлена обработка протоколов проверки обращений через госуслуги аналогично подписанным УКЭП.
-Добавлены варнинги, если загружен не Зип и если не обнаружена квитанция в архиве.
-Оптимизирован алгоритм поиска протоколов проверки для документов.  

-------------------------------------------------
1_3
Устранена причина невозможности открытия архивов с пробелами в пути файла. 

-------------------------------------------------
1_2
-Объеденил обработку названий протоколов с обработкой содержимого. Теперь если протокол подписан УКЭП,
он будет обрабатываться по названию, а если нет, то по содержимому. Теперь не будут обрабатываться только самые каверзные случаи

Известные проблемы 1_2
-Не обрабатываются файлы с пробелами в пути

-------------------------------------------------
1_1
-Полностью переработана обработка протоколов, теперь название файла протокола, каким бы оно ни было, привязывается 
к названию файла, который указан внутри протокола, что позволило закрыть проблему  с обрезанными именами.
-Отключен вывод консоли (замедляет работу)

Известные проблемы 1_1
-Не обрабатываются файлы с пробелами в пути
-Протокола проверки УКЭП не парсятся ибо и сиг и пдф  в одной строке и название не выцепить

-------------------------------------------------
1_0
~95% документов обрабатываются корректно.
Не обрабатываются повторно скаченные архивы из-за добавляющегося пробела в имени.

Известные проблемы 1_0
-Не обрабатываются файлы с пробелами в пути
-Слишком длинные имена файлов не обрабатываются из-за некорректной обрезки имен в архивах 